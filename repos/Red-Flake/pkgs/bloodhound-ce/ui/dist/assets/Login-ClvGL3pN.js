import{bG as v,bH as y,bI as C,r,ai as R,aa as s,bJ as h,bK as U,bL as D,bM as w,bN as A,bO as I,bP as O,aJ as q}from"./index-DV5vAjQm.js";import{O as Q,L as j,a as V}from"./OneTimePasscodeForm-BgKAMJSx.js";import{L as t}from"./LoginPage-DAV7Ub2Z.js";const N=()=>{var b,x,p,L,f;const i=v(),l=y(),a=C(e=>e.auth),[P,u]=r.useState(!1),[E,d]=r.useState(""),[F,c]=r.useState("");r.useEffect(()=>{l.clear()},[l]);const o=R(["listSSOProviders"],({signal:e})=>q.listSSOProviders({signal:e}).then(n=>n.data.data)),g=()=>{u(!1),d(""),c(""),i(I())},S=async(e,n)=>{d(e),c(n),i(O({username:e,password:n}))},T=async e=>{i(O({username:E,password:F,otp:e}))},m=e=>{window.location.assign(`/api/v2/sso/${e}/login`)};if(a.sessionToken!==null&&a.user!==null)return s.jsx(h,{to:U,replace:!0});if(o.isLoading)return s.jsx(t,{children:s.jsx(D,{textAlign:"center",children:s.jsx(w,{})})});if(((x=(b=a.loginError)==null?void 0:b.response)==null?void 0:x.status)===403||!1)return s.jsx(h,{to:A});if(((L=(p=a.loginError)==null?void 0:p.response)==null?void 0:L.status)===400||!1)return s.jsx(t,{children:s.jsx(Q,{onSubmit:T,onCancel:g,loading:a.loginLoading})});if(o.isError||!o.data)return s.jsx(t,{children:s.jsx(j,{onSubmit:S,loading:a.loginLoading})});if(P){if(((f=o.data)==null?void 0:f.length)===1){m(o.data[0].slug);return}return s.jsx(t,{children:s.jsx(V,{providers:o.data,onSubmit:m,onCancel:g})})}return s.jsx(t,{children:s.jsx(j,{onSubmit:S,onLoginViaSSO:()=>u(!0),loading:a.loginLoading})})};export{N as default};
