From 71cbe295561fd8f324d866b5d3292939c7d50ccf Mon Sep 17 00:00:00 2001
From: Moraxyc <i@qaq.li>
Date: Sun, 2 Nov 2025 20:25:02 +0800
Subject: [PATCH] Replace hardcoded PTY and zip-tools paths with placeholders;
 Remove runtime chmod

---
 src/app.ts   | 10 ----------
 src/const.ts |  6 +++---
 2 files changed, 3 insertions(+), 13 deletions(-)

diff --git a/src/app.ts b/src/app.ts
index bacb6270..f3741c90 100755
--- a/src/app.ts
+++ b/src/app.ts
@@ -110,16 +110,6 @@ try {
   process.exit(-1);
 }
 
-(function initCompressModule() {
-  try {
-    fs.chmodSync(GOLANG_ZIP_PATH, 0o755);
-    fs.chmodSync(PTY_PATH, 0o755);
-  } catch (error: any) {
-    logger.error(error?.message);
-    logger.error($t("TXT_CODE_a8b245fa"));
-  }
-})();
-
 // Initialize Websocket server
 io.on("connection", (socket: Socket) => {
   protocol.addGlobalSocket(socket);
diff --git a/src/const.ts b/src/const.ts
index 96f3c96e..bf53db68 100755
--- a/src/const.ts
+++ b/src/const.ts
@@ -15,7 +15,7 @@ function loadSteamCmdPath() {
 const SYS_INFO = `${os.platform()}_${os.arch()}${os.platform() === "win32" ? ".exe" : ""}`;
 const ptyName = `pty_${SYS_INFO}`;
 const frpcName = `frpc_${SYS_INFO}`;
-const PTY_PATH = path.normalize(path.join(process.cwd(), "lib", ptyName));
+const PTY_PATH = "@ptyPath@";
 const FRPC_PATH = path.normalize(path.join(process.cwd(), "lib", frpcName));
 const FILENAME_BLACKLIST = ["\\", "/", ".", "'", '"', "?", "*", "<", ">"];
 const LOCAL_PRESET_LANG_PATH = path.normalize(path.join(process.cwd(), "language"));
@@ -25,12 +25,12 @@ const ZIP_TIMEOUT_SECONDS = 60 * 40;
 const GOLANG_ZIP_NAME = `file_zip_${SYSTEM_TYPE}_${os.arch()}${
   SYSTEM_TYPE === "win32" ? ".exe" : ""
 }`;
-const GOLANG_ZIP_PATH = path.normalize(path.join(process.cwd(), "lib", GOLANG_ZIP_NAME));
+const GOLANG_ZIP_PATH = "@zipToolsPath@";
 const STEAM_CMD_PATH = loadSteamCmdPath();
 const WINDOWS_STEAM_CMD_URL = "https://steamcdn-a.akamaihd.net/client/installer/steamcmd.zip";
 
 const SEVEN_ZIP_NAME = `7z_${os.platform()}_${os.arch()}${os.platform() === "win32" ? ".exe" : ""}`;
-const SEVEN_ZIP_PATH = path.normalize(path.join(process.cwd(), "lib", SEVEN_ZIP_NAME));
+const SEVEN_ZIP_PATH = "@7zPath@";
 
 export {
   FILENAME_BLACKLIST,
-- 
2.51.0

