#!/usr/bin/env bash

# Program for general startup/lock commands.
# This is done to avoid duplicates in i3 config.

function kill {
	pkill -f polybar
	pkill -f dunst
	pkill -f compton
}

function launch {
	tlock
	if [ $(hostname) == "xenon" ]; then
		sudo mount -o noatime /dev/disk/by-uuid/243205de-6503-42f7-baa6-12aaf3c2a68e /mnt/hdd
		sleep 5 && sudo hdparm -y /dev/sdb
	elif [ $(hostname) == "helium" ]; then
		echo ide-disk | sudo tee /sys/class/leds/input0::capslock/trigger
		echo 10 | sudo tee /sys/module/snd_hda_intel/parameters/power_save
		echo 3600 | sudo tee /sys/block/bcache0/bcache/writeback_delay
	fi
}

function reload {
	feh --bg-tile $HOME/Pictures/Background.png &
	sh -c "polybar \$(hostname) || polybar generic" &
	dunst &
	if [ $(hostname) == "neon" ]; then
		compton --backend=glx --vsync drm
	else
		compton
	fi
}

function lock {
	i3lock -c 000000
}

function tlock {
	bash -c 'sleep 0.1; xtrlock-pam -b none' &
}

function suspend {
	if [[ $(hostname) == "xenon" && 6700000 -gt $(vmstat -s | grep used\ memory | cut -d " " -f7) ]] ; then
		systemctl hibernate
		boot
	else
		systemctl suspend
	fi
}

function reboot {
	sudo systemctl kexec || sudo systemctl reboot
}

for var in "$@"
do
	"$var"
done
